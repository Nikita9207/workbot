<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorkBot Architecture</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a2e; color: #eee; padding: 20px; }
        h1 { text-align: center; color: #00d4ff; margin-bottom: 30px; }
        h2 { color: #ff6b6b; margin: 20px 0 10px; border-bottom: 2px solid #ff6b6b; padding-bottom: 5px; }
        h3 { color: #4ecdc4; margin: 15px 0 8px; }
        .container { max-width: 1400px; margin: 0 auto; }

        /* Main Architecture Diagram */
        .architecture { display: flex; flex-direction: column; gap: 20px; margin-bottom: 40px; }
        .layer { background: #16213e; border-radius: 10px; padding: 20px; border: 1px solid #0f3460; }
        .layer-title { font-size: 14px; color: #888; margin-bottom: 10px; text-transform: uppercase; }
        .boxes { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
        .box { background: linear-gradient(135deg, #0f3460, #1a1a2e); border: 2px solid #00d4ff;
               border-radius: 8px; padding: 15px; min-width: 150px; text-align: center; }
        .box.primary { border-color: #ff6b6b; }
        .box.secondary { border-color: #4ecdc4; }
        .box.storage { border-color: #f9ca24; }
        .box-title { font-weight: bold; margin-bottom: 5px; }
        .box-desc { font-size: 12px; color: #aaa; }

        /* Flow arrows */
        .arrow { text-align: center; font-size: 24px; color: #00d4ff; }

        /* Tables */
        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        th, td { border: 1px solid #0f3460; padding: 10px; text-align: left; }
        th { background: #0f3460; color: #00d4ff; }
        tr:nth-child(even) { background: #16213e; }

        /* Code blocks */
        code { background: #0f3460; padding: 2px 6px; border-radius: 4px; font-family: monospace; }
        pre { background: #0f3460; padding: 15px; border-radius: 8px; overflow-x: auto; margin: 10px 0; }

        /* Sections */
        .section { background: #16213e; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .card { background: #1a1a2e; border: 1px solid #0f3460; border-radius: 8px; padding: 15px; }
        .card-header { color: #00d4ff; font-weight: bold; margin-bottom: 10px; }

        /* Flow diagrams */
        .flow { display: flex; align-items: center; flex-wrap: wrap; gap: 10px; margin: 10px 0; }
        .flow-step { background: #0f3460; padding: 8px 15px; border-radius: 20px; font-size: 13px; }
        .flow-arrow { color: #4ecdc4; }

        /* Lists */
        ul { margin-left: 20px; margin-top: 5px; }
        li { margin: 5px 0; }

        /* Colors for different types */
        .text-blue { color: #00d4ff; }
        .text-red { color: #ff6b6b; }
        .text-green { color: #4ecdc4; }
        .text-yellow { color: #f9ca24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>WorkBot - Fitness Training Bot Architecture</h1>

        <!-- Main Architecture -->
        <div class="architecture">
            <div class="layer">
                <div class="layer-title">Entry Point</div>
                <div class="boxes">
                    <div class="box primary">
                        <div class="box-title">Telegram Users</div>
                        <div class="box-desc">Clients & Trainers</div>
                    </div>
                </div>
            </div>

            <div class="arrow">↓</div>

            <div class="layer">
                <div class="layer-title">Bot Layer (internal/bot/)</div>
                <div class="boxes">
                    <div class="box">
                        <div class="box-title">bot.go</div>
                        <div class="box-desc">Main Bot struct<br>API + DB + Config</div>
                    </div>
                    <div class="box">
                        <div class="box-title">handlers.go</div>
                        <div class="box-desc">Message routing<br>State management</div>
                    </div>
                    <div class="box secondary">
                        <div class="box-title">fitness_handlers.go</div>
                        <div class="box-desc">FIT programs<br>Hypertrophy/Strength/FatLoss</div>
                    </div>
                    <div class="box secondary">
                        <div class="box-title">powerlifting_handlers.go</div>
                        <div class="box-desc">PL programs<br>Sheiko/Russian cycle</div>
                    </div>
                    <div class="box">
                        <div class="box-title">admin*.go</div>
                        <div class="box-desc">Admin panel<br>Client management</div>
                    </div>
                </div>
            </div>

            <div class="arrow">↓</div>

            <div class="layer">
                <div class="layer-title">Business Logic</div>
                <div class="boxes">
                    <div class="box secondary">
                        <div class="box-title">generator/</div>
                        <div class="box-desc">Program generators<br>4 types + selector</div>
                    </div>
                    <div class="box secondary">
                        <div class="box-title">training/</div>
                        <div class="box-desc">1PM calculator<br>Periodization</div>
                    </div>
                    <div class="box">
                        <div class="box-title">clients/ai/</div>
                        <div class="box-desc">PL templates<br>Groq/Whisper</div>
                    </div>
                    <div class="box">
                        <div class="box-title">models/</div>
                        <div class="box-desc">Data structures<br>Program/Workout/Exercise</div>
                    </div>
                </div>
            </div>

            <div class="arrow">↓</div>

            <div class="layer">
                <div class="layer-title">Data & Export Layer</div>
                <div class="boxes">
                    <div class="box storage">
                        <div class="box-title">repository/</div>
                        <div class="box-desc">Database access<br>CRUD operations</div>
                    </div>
                    <div class="box storage">
                        <div class="box-title">excel/</div>
                        <div class="box-desc">Excel export<br>Training plans</div>
                    </div>
                    <div class="box storage">
                        <div class="box-title">gsheets/</div>
                        <div class="box-desc">Google Sheets<br>OAuth2 integration</div>
                    </div>
                </div>
            </div>

            <div class="arrow">↓</div>

            <div class="layer">
                <div class="layer-title">Storage</div>
                <div class="boxes">
                    <div class="box storage">
                        <div class="box-title">PostgreSQL</div>
                        <div class="box-desc">14 tables<br>Clients, Plans, Exercises</div>
                    </div>
                    <div class="box storage">
                        <div class="box-title">data/*.json</div>
                        <div class="box-desc">Exercise library<br>Barbell, TRX, KB</div>
                    </div>
                    <div class="box storage">
                        <div class="box-title">Google Drive</div>
                        <div class="box-desc">Spreadsheets<br>Client folders</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Generator Types -->
        <div class="section">
            <h2>Program Generators (internal/generator/)</h2>
            <div class="grid">
                <div class="card">
                    <div class="card-header">Strength Generator</div>
                    <ul>
                        <li><strong>Goal:</strong> Maximum strength</li>
                        <li><strong>Duration:</strong> 6-12 weeks</li>
                        <li><strong>Frequency:</strong> 3-4 days/week</li>
                        <li><strong>Intensity:</strong> 80-100%</li>
                        <li><strong>Periodization:</strong> Block (3 phases)</li>
                        <li><strong>Phases:</strong> Accumulation → Transformation → Realization</li>
                        <li><strong>Rep Range:</strong> 5-8 main, 8-12 accessory</li>
                    </ul>
                </div>
                <div class="card">
                    <div class="card-header">Hypertrophy Generator</div>
                    <ul>
                        <li><strong>Goal:</strong> Muscle growth (MEV→MRV)</li>
                        <li><strong>Duration:</strong> 8-12 weeks</li>
                        <li><strong>Frequency:</strong> 3-5 days/week</li>
                        <li><strong>Intensity:</strong> 65-82% (wave)</li>
                        <li><strong>Periodization:</strong> Block + Wave loading</li>
                        <li><strong>Splits:</strong> Full Body / Upper-Lower / PPL</li>
                        <li><strong>Rep Range:</strong> 8-12</li>
                    </ul>
                </div>
                <div class="card">
                    <div class="card-header">Fat Loss Generator</div>
                    <ul>
                        <li><strong>Goal:</strong> Fat loss + muscle preservation</li>
                        <li><strong>Duration:</strong> 8-12 weeks</li>
                        <li><strong>Frequency:</strong> 4-5 days/week</li>
                        <li><strong>Intensity:</strong> 75-85%</li>
                        <li><strong>Periodization:</strong> Linear (density)</li>
                        <li><strong>Components:</strong> Strength + HIIT + LISS + Finisher</li>
                        <li><strong>Rest:</strong> 60 sec (short)</li>
                    </ul>
                </div>
                <div class="card">
                    <div class="card-header">Hyrox Generator</div>
                    <ul>
                        <li><strong>Goal:</strong> Functional fitness competition</li>
                        <li><strong>Duration:</strong> 12-16 weeks</li>
                        <li><strong>Frequency:</strong> 4-5 days/week</li>
                        <li><strong>Intensity:</strong> 60-95% (phases)</li>
                        <li><strong>Periodization:</strong> Reverse (4 phases)</li>
                        <li><strong>Phases:</strong> Strength → Power Endurance → Specific → Taper</li>
                        <li><strong>Stations:</strong> Ski Erg, Sled, Burpee, Row, Farmer, Lunges, Wall Balls</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- FIT Flow -->
        <div class="section">
            <h2>FIT Program Generation Flow</h2>
            <div class="flow">
                <span class="flow-step">Select Type</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step">Select Client</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step">Enter Weight</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step">Select Weeks (4/8/12)</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step">Select Days (2-5)</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step">Select Split/HIIT</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step text-green">Generate</span>
            </div>
            <h3>State Management</h3>
            <pre>fitnessStates = {
    programType:  map[chatID]string   // hypertrophy|strength|fatloss|hyrox
    clientID:     map[chatID]int
    clientWeight: map[chatID]float64
    weeks:        map[chatID]int      // 4|8|12
    daysPerWeek:  map[chatID]int      // 2|3|4|5
    split:        map[chatID]string   // fullbody|upper_lower|push_pull_legs
    includeHIIT:  map[chatID]bool
    lastProgram:  map[chatID]*GeneratedProgram
}</pre>
        </div>

        <!-- PL Flow -->
        <div class="section">
            <h2>Powerlifting Program Generation Flow</h2>
            <div class="flow">
                <span class="flow-step">Select Lift Type</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step">Select Template</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step">Enter 1RM Maxes</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step">Select Days/Week</span>
                <span class="flow-arrow">→</span>
                <span class="flow-step text-green">Generate</span>
            </div>
            <h3>Available Templates</h3>
            <table>
                <tr><th>Template</th><th>Duration</th><th>Level</th><th>Focus</th></tr>
                <tr><td>Sheiko 12 weeks</td><td>12 weeks</td><td>2 разряд - КМС</td><td>High frequency, 80-90%</td></tr>
                <tr><td>Sheiko КМС/МС</td><td>4 weeks</td><td>КМС - МС</td><td>Competition prep</td></tr>
                <tr><td>Golovinsky</td><td>7-10 weeks</td><td>1 разряд+</td><td>Wave periodization</td></tr>
                <tr><td>Muravyov</td><td>16 weeks</td><td>МС - МСМК</td><td>Classic 4-week blocks</td></tr>
                <tr><td>Russian Cycle</td><td>6 weeks</td><td>All levels</td><td>Aggressive progression</td></tr>
                <tr><td>Hip Thrust</td><td>12 weeks</td><td>All levels</td><td>Glute specialization</td></tr>
            </table>
        </div>

        <!-- Database Schema -->
        <div class="section">
            <h2>Database Schema (PostgreSQL)</h2>
            <div class="grid">
                <div class="card">
                    <div class="card-header">Core Tables</div>
                    <ul>
                        <li><code>clients</code> - User data, telegram_id</li>
                        <li><code>admins</code> - Trainer accounts</li>
                        <li><code>client_forms</code> - Profile data (gender, weight, height)</li>
                        <li><code>exercises</code> - Exercise library</li>
                        <li><code>exercise_1pm</code> - 1RM tracking</li>
                    </ul>
                </div>
                <div class="card">
                    <div class="card-header">Training Plans</div>
                    <ul>
                        <li><code>training_plans</code> - Program metadata</li>
                        <li><code>mesocycles</code> - Training phases/blocks</li>
                        <li><code>microcycles</code> - Weekly cycles</li>
                        <li><code>plan_exercises</code> - Exercise assignments</li>
                        <li><code>plan_progression</code> - Weekly progression</li>
                    </ul>
                </div>
                <div class="card">
                    <div class="card-header">Tracking & Scheduling</div>
                    <ul>
                        <li><code>training_logs</code> - Workout completion</li>
                        <li><code>appointments</code> - Session bookings</li>
                        <li><code>trainer_schedule</code> - Availability slots</li>
                        <li><code>volume_analytics</code> - Weekly metrics</li>
                        <li><code>client_goals</code> - Goal history</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Exercise Selection -->
        <div class="section">
            <h2>Exercise Selection System</h2>
            <h3>Selection Criteria</h3>
            <div class="grid">
                <div class="card">
                    <div class="card-header">Filters</div>
                    <ul>
                        <li>Movement type (push/pull/squat/hinge/lunge/core)</li>
                        <li>Muscle groups (chest, back, quads, hamstrings, glutes...)</li>
                        <li>Equipment (barbell, dumbbell, kettlebell, TRX, machines)</li>
                        <li>Difficulty level (beginner/intermediate/advanced)</li>
                        <li>Client constraints (injuries/limitations)</li>
                    </ul>
                </div>
                <div class="card">
                    <div class="card-header">Day Patterns</div>
                    <ul>
                        <li><strong>Push:</strong> Chest compound → Shoulder → Chest iso → Triceps</li>
                        <li><strong>Pull:</strong> Back compound → Back compound → Rear delts → Biceps</li>
                        <li><strong>Legs:</strong> Squat → Hinge → Lunge → Quad iso → Ham iso → Calf</li>
                        <li><strong>Upper:</strong> Chest → Back → Shoulder → Back iso → Arms</li>
                        <li><strong>Full Body:</strong> Squat + Push + Pull + Hinge + Core</li>
                    </ul>
                </div>
            </div>
            <h3>Gender Adaptation</h3>
            <table>
                <tr><th>Aspect</th><th>Female</th><th>Male</th></tr>
                <tr><td>Lower body focus</td><td>More glute work (Hip Thrust, Bulgarian lunges)</td><td>Balanced legs (Leg press, Calf raises)</td></tr>
                <tr><td>Finishing exercises</td><td>Glute bridge</td><td>Hyperextension</td></tr>
                <tr><td>Fat Loss finisher</td><td>Glute bridge + Lunges circuit</td><td>Burpee + Mountain climbers</td></tr>
            </table>
        </div>

        <!-- Export System -->
        <div class="section">
            <h2>Export System</h2>
            <div class="grid">
                <div class="card">
                    <div class="card-header">Excel Export (excelize)</div>
                    <ul>
                        <li>Multi-sheet workbooks</li>
                        <li>Periodization color-coding</li>
                        <li>Weight progression tables</li>
                        <li>Volume charts</li>
                        <li>1RM history tracking</li>
                    </ul>
                </div>
                <div class="card">
                    <div class="card-header">Google Sheets (OAuth2 / Service Account)</div>
                    <ul>
                        <li>Program spreadsheets</li>
                        <li>Weekly breakdown sheets</li>
                        <li>Auto-calculated weights from %1RM</li>
                        <li>Result tracking</li>
                        <li>Shareable URLs</li>
                    </ul>
                </div>
                <div class="card">
                    <div class="card-header">Text Export</div>
                    <ul>
                        <li>Formatted .txt files</li>
                        <li>Send to client via Telegram</li>
                        <li>Plain text (no Markdown)</li>
                        <li>Unicode separators (━, │, ═)</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- File Structure -->
        <div class="section">
            <h2>Project Structure</h2>
            <pre>
workbot/
├── cmd/
│   ├── main.go                 # Entry point
│   ├── oauth_setup/            # Google OAuth setup
│   ├── plgen/                  # PL program CLI
│   └── test_*/                 # Test utilities
├── internal/
│   ├── bot/                    # Telegram handlers
│   │   ├── bot.go              # Bot struct
│   │   ├── handlers.go         # Message routing
│   │   ├── fitness_handlers.go # FIT programs
│   │   ├── powerlifting_handlers.go
│   │   ├── admin*.go           # Admin panel
│   │   └── booking_handlers.go
│   ├── generator/              # Program generators
│   │   ├── selector.go         # Exercise selection
│   │   ├── generator_strength.go
│   │   ├── generator_hypertrophy.go
│   │   ├── generator_fatloss.go
│   │   ├── generator_hyrox.go
│   │   └── progression/        # Weight/TRX/KB progression
│   ├── repository/             # Database layer
│   │   ├── client_repo.go
│   │   ├── exercise_repo.go
│   │   ├── plan_repo.go
│   │   └── appointment_repo.go
│   ├── models/                 # Data structures
│   ├── excel/                  # Excel export
│   ├── gsheets/                # Google Sheets
│   ├── training/               # 1PM, periodization
│   └── config/                 # Configuration
├── clients/
│   └── ai/                     # AI/PL templates
│       ├── powerlifting_templates.go
│       ├── templates/*.json    # Sheiko, Russian cycle...
│       └── groq.go             # LLM integration
├── data/                       # Exercise databases
│   ├── barbell_dumbbell.json
│   ├── trx.json
│   ├── kettlebell.json
│   └── cardio_metabolic.json
└── migrations/                 # SQL migrations
            </pre>
        </div>

        <!-- Summary Stats -->
        <div class="section">
            <h2>Summary</h2>
            <table>
                <tr><th>Metric</th><th>Value</th></tr>
                <tr><td>Total Go files</td><td>89</td></tr>
                <tr><td>Database tables</td><td>14</td></tr>
                <tr><td>Generator types</td><td>4 (Strength, Hypertrophy, FatLoss, Hyrox)</td></tr>
                <tr><td>PL templates</td><td>6+ (Sheiko, Golovinsky, Russian cycle...)</td></tr>
                <tr><td>Export formats</td><td>3 (TXT, Excel, Google Sheets)</td></tr>
                <tr><td>Authentication</td><td>OAuth2 + Service Account</td></tr>
            </table>
        </div>

    </div>
</body>
</html>
